<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My First Web Page</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            text-align: center;
            padding: 50px;
        }
        h1 {
            color: #333;
        }
        h2 {
            color: #7c1313;
        }
        p {
            color: #666;
            font-size: 18px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .form-container {
            margin: 20px 0;
            display: none; /* Initially hide the form container */
        }
        input {
            padding: 10px;
            margin: 5px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <h1>Welcome to Webserv 42 by Shelal and Tlam</h1>
    <p>Press any buttons to test HTTP methods</p>

    <h2>GET Requests</h2>
    <button onclick="window.location.href='about.html'">Go to About Page</button>
    <button onclick="window.location.href='contact.html'">Go to Contact Page</button>
    <button onclick="window.location.href='noperm.html'">Go to No Permission Page</button>
    <button onclick="window.location.href='noexist.html'">Go to No Exist Page</button>

    <div class="spacer"></div>

    <h2>POST Requests</h2>
    <p>Here you can send data to the server using a POST request.</p>
    
    <button onclick="toggleJsonForm()">Send JSON Data</button>

    <div class="form-container" id="jsonForm">
        <h3>Enter JSON Data</h3>
        <input type="text" id="name" placeholder="Enter your name" />
        <input type="number" id="age" placeholder="Enter your age" />
        <input type="text" id="city" placeholder="Enter your city" />
        <button onclick="sendJsonData()">Submit JSON Data</button>
    </div>

    <button onclick="toggleForm()">Submit Form Data</button>

    <div class="form-container" id="formData">
        <h3>Enter Form Data</h3>
        <input type="text" id="formName" placeholder="Enter your name" />
        <input type="number" id="formAge" placeholder="Enter your age" />
        <button onclick="submitForm()">Submit Form Data</button>
    </div>

    <form id="uploadForm" style="display: none;" enctype="multipart/form-data">
        <input type="file" id="fileInput" name="file" />
    </form>

    <p id="message" style="display: none; color: green;"></p>

    <div class="spacer"></div>

    <h2>CGI</h2>
    <p>Tests our bash and python CGIs right here.</p>

    <!-- CGI POST buttons -->
    <button onclick="triggerFileUpload('upload.py')">POST to upload.py</button>
    <button onclick="triggerFileUpload('upload.sh')">POST to upload.sh</button>

    <script>
        let currentCgiScript = ''; // This will store the current script (upload.py or upload.sh)

        // Function to trigger the file upload window and store which CGI script to post to
        function triggerFileUpload(script) {
            currentCgiScript = script;  // Save which script to use for upload
            document.getElementById('fileInput').click();  // Open the file picker
        }

        // Event listener for file input change to handle file selection and submission
        document.getElementById('fileInput').addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const formData = new FormData();
                formData.append('file', file);

                // Send the file to the selected CGI script
                const uploadUrl = `http://localhost:8080/cgi-bin/${currentCgiScript}`;

                fetch(uploadUrl, {
                    method: 'POST',
                    body: formData,
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    console.log(`File uploaded to ${currentCgiScript} successfully:`, data);
                    alert(`File uploaded to ${currentCgiScript} successfully!`);
                })
                .catch(error => {
                    console.error(`Error uploading file to ${currentCgiScript}:`, error);
                });
            }
        });

        // Function to toggle the visibility of the JSON data form
        function toggleJsonForm() {
            const formContainer = document.getElementById('jsonForm');
            formContainer.style.display = formContainer.style.display === 'none' ? 'block' : 'none';
            document.getElementById('formData').style.display = 'none'; // Hide form data on toggle
        }

        // Function to toggle the visibility of the form data form
        function toggleForm() {
            const formContainer = document.getElementById('formData');
            formContainer.style.display = formContainer.style.display === 'none' ? 'block' : 'none';
            document.getElementById('jsonForm').style.display = 'none'; // Hide JSON form on toggle
        }

        // Function for sending JSON data using input fields
        function sendJsonData() {
            const name = document.getElementById("name").value;
            const age = document.getElementById("age").value;
            const city = document.getElementById("city").value;

            if (name && age && city) { // Ensure all fields are filled
                const jsonData = {
                    name: name,
                    age: age,
                    city: city
                };

                fetch('http://localhost:8080/data/json', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(jsonData)
                })
                .then(response => response.json())
                .then(data => {
                    console.log('Success:', data);
                    alert('JSON Data Sent!');
                    resetJsonForm(); // Reset the JSON form after successful submission
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            } else {
                alert("All fields must be filled out.");
            }
        }

        // Function to reset the JSON form and hide it
        function resetJsonForm() {
            document.getElementById("name").value = '';
            document.getElementById("age").value = '';
            document.getElementById("city").value = '';
            const formContainer = document.getElementById('jsonForm');
            formContainer.style.display = 'none'; // Hide the form
        }

        // Function for submitting form data using input fields
        function submitForm() {
            const formName = document.getElementById("formName").value;
            const formAge = document.getElementById("formAge").value;

            if (formName && formAge) { // Ensure all fields are filled
                // Construct the URL-encoded data
                const formData = new URLSearchParams();
                formData.append('name', formName);
                formData.append('age', formAge); // Replace with the actual email input if needed

                fetch('http://localhost:8080/data/formdata.txt', { // Change to your desired URL
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded', // Set the Content-Type
                    },
                    body: formData.toString() // Convert to a URL-encoded string
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text(); // Get the response text
                })
                .then(data => {
                    console.log('Success:', data);
                    alert('Form Data Submitted!');
                    resetForm(); // Reset the form after successful submission
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            } else {
                alert("All fields must be filled out.");
            }
        }

        // Function to reset the form data and hide it
        function resetForm() {
            document.getElementById("formName").value = '';
            document.getElementById("formAge").value = '';
            const formContainer = document.getElementById('formData');
            formContainer.style.display = 'none'; // Hide the form
        }
    </script>
</body>
</html>